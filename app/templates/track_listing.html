{% extends "base.html" %}
{% block page_css %}
    <link href="{{ url_for('static', path='/css/pages/tracks.css') }}"
          rel="stylesheet" />
{% endblock page_css %}
{% block content %}
    <div class="mb-4">
        <h1 class="display-5 fw-bold mb-2">{{ page_title }}</h1>
        {% if page_subtitle %}<p class="text-muted fs-5">{{ page_subtitle }}</p>{% endif %}
    </div>
    <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
        {% for track in tracks %}
            <div class="col">
                <div class="card h-100 track-card shadow-sm">
                    <a href="{{ url_for('track_detail', track_id=track.track_id) }}"
                       class="text-decoration-none overflow-hidden d-block">
                        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='300'><rect width='100%' height='100%' fill='%23343a40'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23adb5bd' font-size='20' font-family='system-ui'>{{ track.title }}</text></svg>"
                             class="card-img-top track-card-img"
                             alt="Cover art for {{ track.title }} by {{ track.artist }}" />
                        </a>
                        <div class="card-body d-flex flex-column p-3">
                            <a href="{{ url_for('track_detail', track_id=track.track_id) }}"
                               class="text-decoration-none text-reset">
                                <h5 class="card-title track-card-title mb-1 text-truncate"
                                    title="{{ track.title }}">{{ track.title }}</h5>
                                <h6 class="card-subtitle text-body-secondary track-card-artist mb-2 text-truncate"
                                    title="{{ track.artist }}">{{ track.artist }}</h6>
                            </a>
                            <div class="track-metadata d-flex gap-2 mb-2 flex-wrap">
                                <span class="badge bg-secondary">{{ track.genre }}</span>
                                <span class="badge bg-dark">{{ track.bpm }} BPM</span>
                                <span class="badge bg-dark">{{ track.music_key }}</span>
                            </div>
                            <div class="mt-auto">
                                <p class="track-card-price mb-2 fw-bold text-success fs-5">${{ "%.2f"|format(track.price) }}</p>
                                {% set track_ids = cart.items | map(attribute='track_id') | list %}
                                {% set is_in_cart = track.track_id in track_ids %}
                                {% include "partials/add_to_cart_button.html" %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endblock content %}
